tosca_definitions_version: cloudify_dsl_1_2
 
 
imports:
  - http://www.getcloudify.org/spec/cloudify/3.3.1/types.yaml
  - openstack-plugin.yaml
  - http://www.getcloudify.org/spec/diamond-plugin/1.3.1/plugin.yaml
 
node_types:
  alien.nodes.openstack.Compute:
    derived_from: cloudify.openstack.nodes.Server
    properties:
      _a4c_substitute_for:
        default: []
      _a4c_att_ip_address:
        default:
          function: get_attribute
          parameters:
            - SELF
            - ip
      _a4c_att_public_ip_address:
        default:
          function: get_attribute
          parameters:
            - TARGET
            - cloudify.openstack.server_connected_to_floating_ip
            - floating_ip_address
  alien.nodes.openstack.PublicNetwork:
    derived_from: cloudify.openstack.nodes.FloatingIP
    properties:
      _a4c_substitute_for:
        default: []
 
  starlings.nodes.Consul:
    derived_from: cloudify.nodes.SoftwareComponent
  starlings.nodes.Logstash:
    derived_from: cloudify.nodes.Root
  starlings.nodes.TopBeat:
    derived_from: cloudify.nodes.SoftwareComponent
  starlings.nodes.KibanaDashboard:
    derived_from: cloudify.nodes.Root
  starlings.nodes.Kibana:
    derived_from: cloudify.nodes.Root
  starlings.nodes.Elasticsearch:
    derived_from: cloudify.nodes.Root
  starlings.nodes.BeatsDashboards:
    derived_from: cloudify.nodes.Root
  starlings.nodes.FileBeat:
    derived_from: cloudify.nodes.SoftwareComponent
  starlings.nodes.PacketBeat:
    derived_from: cloudify.nodes.SoftwareComponent
  starlings.nodes.Java:
    derived_from: cloudify.nodes.SoftwareComponent
 
relationships:
  starlings.relationships.ConnectsConsulAgentToServer:
    derived_from: cloudify.relationships.connected_to
  starlings.relationships.ConnectsToConsulAgent:
    derived_from: cloudify.relationships.connected_to
  starlings.relationships.HostedOnJavaRuntime:
    derived_from: cloudify.relationships.contained_in
  starlings.relationships.ConnectsLogstashToElasticsearch:
    derived_from: cloudify.relationships.connected_to
  starlings.relationships.ConnectsBeatToLS:
    derived_from: cloudify.relationships.connected_to
  starlings.relationships.ConnectsBeatToES:
    derived_from: cloudify.relationships.connected_to
  starlings.relationships.DashboardHostedOnKibana:
    derived_from: cloudify.relationships.contained_in
  starlings.relationships.ConnectsKibanaToElasticsearch:
    derived_from: cloudify.relationships.connected_to
  starlings.relationships.BeatsDashboardsHostedOnKibana:
    derived_from: cloudify.relationships.contained_in
 
node_templates:
 
  Compute_ES:
    type: alien.nodes.openstack.Compute
    properties:
      server:
        availability_zone: nova
      image: 89ec515c-3251-4c2f-8402-bda280c31650
      flavor: 2
      cloudify_agent:
        user: cloud-user
 
    interfaces:
      cloudify.interfaces.monitoring_agent:
        install:
          implementation: diamond.diamond_agent.tasks.install
          inputs:
            diamond_config:
               interval: 1
        start: diamond.diamond_agent.tasks.start
        stop: diamond.diamond_agent.tasks.stop
        uninstall: diamond.diamond_agent.tasks.uninstall
      cloudify.interfaces.monitoring:
        start:
          implementation: diamond.diamond_agent.tasks.add_collectors
          inputs:
            collectors_config:
               CPUCollector: {}
               MemoryCollector: {}
               LoadAverageCollector: {}
               DiskUsageCollector:
                 config:
                   devices: x?vd[a-z]+[0-9]*$
               NetworkCollector: {}
  Compute_KBN:
    type: alien.nodes.openstack.Compute
    properties:
      server:
        availability_zone: nova
      image: 89ec515c-3251-4c2f-8402-bda280c31650
      flavor: 2
      cloudify_agent:
        user: cloud-user
 
    relationships:
      - target: _a4c_floating_ip_Compute_KBN_on_Network
        type: cloudify.openstack.server_connected_to_floating_ip
    interfaces:
      cloudify.interfaces.monitoring_agent:
        install:
          implementation: diamond.diamond_agent.tasks.install
          inputs:
            diamond_config:
               interval: 1
        start: diamond.diamond_agent.tasks.start
        stop: diamond.diamond_agent.tasks.stop
        uninstall: diamond.diamond_agent.tasks.uninstall
      cloudify.interfaces.monitoring:
        start:
          implementation: diamond.diamond_agent.tasks.add_collectors
          inputs:
            collectors_config:
               CPUCollector: {}
               MemoryCollector: {}
               LoadAverageCollector: {}
               DiskUsageCollector:
                 config:
                   devices: x?vd[a-z]+[0-9]*$
               NetworkCollector: {}
  _a4c_floating_ip_Compute_KBN_on_Network:
    type: alien.nodes.openstack.PublicNetwork
    properties:
      floatingip:
        floating_network_name: Public_Network
  Compute_LS:
    type: alien.nodes.openstack.Compute
    properties:
      server:
        availability_zone: nova
      image: 89ec515c-3251-4c2f-8402-bda280c31650
      flavor: 2
      cloudify_agent:
        user: cloud-user
 
    interfaces:
      cloudify.interfaces.monitoring_agent:
        install:
          implementation: diamond.diamond_agent.tasks.install
          inputs:
            diamond_config:
               interval: 1
        start: diamond.diamond_agent.tasks.start
        stop: diamond.diamond_agent.tasks.stop
        uninstall: diamond.diamond_agent.tasks.uninstall
      cloudify.interfaces.monitoring:
        start:
          implementation: diamond.diamond_agent.tasks.add_collectors
          inputs:
            collectors_config:
               CPUCollector: {}
               MemoryCollector: {}
               LoadAverageCollector: {}
               DiskUsageCollector:
                 config:
                   devices: x?vd[a-z]+[0-9]*$
               NetworkCollector: {}
  Compute_CS:
    type: alien.nodes.openstack.Compute
    properties:
      server:
        availability_zone: nova
      image: 89ec515c-3251-4c2f-8402-bda280c31650
      flavor: 2
      cloudify_agent:
        user: cloud-user
 
    interfaces:
      cloudify.interfaces.monitoring_agent:
        install:
          implementation: diamond.diamond_agent.tasks.install
          inputs:
            diamond_config:
               interval: 1
        start: diamond.diamond_agent.tasks.start
        stop: diamond.diamond_agent.tasks.stop
        uninstall: diamond.diamond_agent.tasks.uninstall
      cloudify.interfaces.monitoring:
        start:
          implementation: diamond.diamond_agent.tasks.add_collectors
          inputs:
            collectors_config:
               CPUCollector: {}
               MemoryCollector: {}
               LoadAverageCollector: {}
               DiskUsageCollector:
                 config:
                   devices: x?vd[a-z]+[0-9]*$
               NetworkCollector: {}
 
  Consul_A_ES:
    type: starlings.nodes.Consul
    instances:
      deploy: 1
    interfaces:
      cloudify.interfaces.lifecycle:
        stop: wrapper/Consul_A_ES/tosca.interfaces.node.lifecycle.Standard/stop/artifacts/consul-types/scripts/_a4c_consul_stop.py
        start: wrapper/Consul_A_ES/tosca.interfaces.node.lifecycle.Standard/start/artifacts/consul-types/scripts/_a4c_consul_start.py
        create: wrapper/Consul_A_ES/tosca.interfaces.node.lifecycle.Standard/create/artifacts/consul-types/scripts/_a4c_consul_install.py
        configure: wrapper/Consul_A_ES/tosca.interfaces.node.lifecycle.Standard/configure/artifacts/consul-types/scripts/_a4c_consul_configure.py
    relationships:
      - target: Compute_ES
        type: cloudify.relationships.contained_in
      - target: Consul_Server
        type: starlings.relationships.ConnectsConsulAgentToServer
        source_interfaces:
          cloudify.interfaces.relationship_lifecycle:
            preconfigure: wrapper/Consul_A_ES_Consul_Server/connectsConsulAgentToServerConsul_Server/artifacts/consul-types/scripts/_a4c_consul_connects_agent_to_server.py
  Logstash:
    type: starlings.nodes.Logstash
    instances:
      deploy: 1
    interfaces:
      cloudify.interfaces.lifecycle:
        stop: wrapper/Logstash/tosca.interfaces.node.lifecycle.Standard/stop/artifacts/logstash-types/scripts/_a4c_logstash_stop.py
        start: wrapper/Logstash/tosca.interfaces.node.lifecycle.Standard/start/artifacts/logstash-types/scripts/_a4c_logstash_start.py
        create: wrapper/Logstash/tosca.interfaces.node.lifecycle.Standard/create/artifacts/logstash-types/scripts/_a4c_logstash_install.py
        configure: wrapper/Logstash/tosca.interfaces.node.lifecycle.Standard/configure/artifacts/logstash-types/scripts/_a4c_logstash_configure.py
      custom:
        change_input: wrapper/Logstash/custom/change_input/artifacts/logstash-types/scripts/_a4c_logstash_changeInput.py
        change_filter: wrapper/Logstash/custom/change_filter/artifacts/logstash-types/scripts/_a4c_logstash_changeFilter.py
        change_output: wrapper/Logstash/custom/change_output/artifacts/logstash-types/scripts/_a4c_logstash_changeOutput.py
    relationships:
      - target: Java_LS
        type: starlings.relationships.HostedOnJavaRuntime
      - target: Consul_A_LS
        type: starlings.relationships.ConnectsToConsulAgent
      - target: Elasticsearch
        type: starlings.relationships.ConnectsLogstashToElasticsearch
        source_interfaces:
          cloudify.interfaces.relationship_lifecycle:
            preconfigure: wrapper/Logstash_Elasticsearch/connectsLogstashToElasticsearchElasticsearch/artifacts/logstash-types/scripts/_a4c_logstash-to-elasticsearch.py
  Consul_A_LS:
    type: starlings.nodes.Consul
    instances:
      deploy: 1
    interfaces:
      cloudify.interfaces.lifecycle:
        stop: wrapper/Consul_A_LS/tosca.interfaces.node.lifecycle.Standard/stop/artifacts/consul-types/scripts/_a4c_consul_stop.py
        start: wrapper/Consul_A_LS/tosca.interfaces.node.lifecycle.Standard/start/artifacts/consul-types/scripts/_a4c_consul_start.py
        create: wrapper/Consul_A_LS/tosca.interfaces.node.lifecycle.Standard/create/artifacts/consul-types/scripts/_a4c_consul_install.py
        configure: wrapper/Consul_A_LS/tosca.interfaces.node.lifecycle.Standard/configure/artifacts/consul-types/scripts/_a4c_consul_configure.py
    relationships:
      - target: Consul_Server
        type: starlings.relationships.ConnectsConsulAgentToServer
        source_interfaces:
          cloudify.interfaces.relationship_lifecycle:
            preconfigure: wrapper/Consul_A_LS_Consul_Server/connectsConsulAgentToServerConsul_Server/artifacts/consul-types/scripts/_a4c_consul_connects_agent_to_server.py
      - target: Compute_LS
        type: cloudify.relationships.contained_in
  TopBeatKBN:
    type: starlings.nodes.TopBeat
    instances:
      deploy: 1
    interfaces:
      cloudify.interfaces.lifecycle:
        stop: wrapper/TopBeatKBN/tosca.interfaces.node.lifecycle.Standard/stop/artifacts/beats-types/scripts/_a4c_stop_beat.py
        start: wrapper/TopBeatKBN/tosca.interfaces.node.lifecycle.Standard/start/artifacts/beats-types/scripts/_a4c_start_beat.py
        configure: wrapper/TopBeatKBN/tosca.interfaces.node.lifecycle.Standard/configure/artifacts/beats-types/scripts/_a4c_configure_topbeat.py
        create: wrapper/TopBeatKBN/tosca.interfaces.node.lifecycle.Standard/create/artifacts/beats-types/scripts/_a4c_install_beat.py
    relationships:
      - target: Elasticsearch
        type: starlings.relationships.ConnectsBeatToES
        source_interfaces:
          cloudify.interfaces.relationship_lifecycle:
            postconfigure: wrapper/TopBeatKBN_Elasticsearch/connectsBeatToEsElasticsearch/artifacts/beats-types/scripts/_a4c_post_configure_beat_to_elasticsearch.py
      - target: Logstash
        type: starlings.relationships.ConnectsBeatToLS
        source_interfaces:
          cloudify.interfaces.relationship_lifecycle:
            postconfigure: wrapper/TopBeatKBN_Logstash/connectsBeatToLsLogstash/artifacts/beats-types/scripts/_a4c_post_configure_beat_to_logstash.py
      - target: Consul_A_KBN
        type: starlings.relationships.ConnectsToConsulAgent
      - target: Compute_KBN
        type: cloudify.relationships.contained_in
  KibanaDashboard:
    type: starlings.nodes.KibanaDashboard
    instances:
      deploy: 1
    interfaces:
      custom:
        updateDashboardFile: wrapper/KibanaDashboard/custom/updateDashboardFile/artifacts/kibana-types/scripts/_a4c_updateDashboardFile.py
    relationships:
      - target: Kibana
        type: starlings.relationships.DashboardHostedOnKibana
        source_interfaces:
          cloudify.interfaces.relationship_lifecycle:
            postconfigure: wrapper/KibanaDashboard_Kibana/dashboardHostedOnKibanaKibana/artifacts/kibana-types/scripts/_a4c_dashboardHostedOnKibana_post_configure_source.py
  Consul_A_KBN:
    type: starlings.nodes.Consul
    instances:
      deploy: 1
    interfaces:
      cloudify.interfaces.lifecycle:
        stop: wrapper/Consul_A_KBN/tosca.interfaces.node.lifecycle.Standard/stop/artifacts/consul-types/scripts/_a4c_consul_stop.py
        start: wrapper/Consul_A_KBN/tosca.interfaces.node.lifecycle.Standard/start/artifacts/consul-types/scripts/_a4c_consul_start.py
        create: wrapper/Consul_A_KBN/tosca.interfaces.node.lifecycle.Standard/create/artifacts/consul-types/scripts/_a4c_consul_install.py
        configure: wrapper/Consul_A_KBN/tosca.interfaces.node.lifecycle.Standard/configure/artifacts/consul-types/scripts/_a4c_consul_configure.py
    relationships:
      - target: Consul_Server
        type: starlings.relationships.ConnectsConsulAgentToServer
        source_interfaces:
          cloudify.interfaces.relationship_lifecycle:
            preconfigure: wrapper/Consul_A_KBN_Consul_Server/connectsConsulAgentToServerConsul_Server/artifacts/consul-types/scripts/_a4c_consul_connects_agent_to_server.py
      - target: Compute_KBN
        type: cloudify.relationships.contained_in
  TopBeatES:
    type: starlings.nodes.TopBeat
    instances:
      deploy: 1
    interfaces:
      cloudify.interfaces.lifecycle:
        stop: wrapper/TopBeatES/tosca.interfaces.node.lifecycle.Standard/stop/artifacts/beats-types/scripts/_a4c_stop_beat.py
        start: wrapper/TopBeatES/tosca.interfaces.node.lifecycle.Standard/start/artifacts/beats-types/scripts/_a4c_start_beat.py
        configure: wrapper/TopBeatES/tosca.interfaces.node.lifecycle.Standard/configure/artifacts/beats-types/scripts/_a4c_configure_topbeat.py
        create: wrapper/TopBeatES/tosca.interfaces.node.lifecycle.Standard/create/artifacts/beats-types/scripts/_a4c_install_beat.py
    relationships:
      - target: Elasticsearch
        type: starlings.relationships.ConnectsBeatToES
        source_interfaces:
          cloudify.interfaces.relationship_lifecycle:
            postconfigure: wrapper/TopBeatES_Elasticsearch/connectsBeatToEsElasticsearch/artifacts/beats-types/scripts/_a4c_post_configure_beat_to_elasticsearch.py
      - target: Logstash
        type: starlings.relationships.ConnectsBeatToLS
        source_interfaces:
          cloudify.interfaces.relationship_lifecycle:
            postconfigure: wrapper/TopBeatES_Logstash/connectsBeatToLsLogstash/artifacts/beats-types/scripts/_a4c_post_configure_beat_to_logstash.py
      - target: Compute_ES
        type: cloudify.relationships.contained_in
      - target: Consul_A_ES
        type: starlings.relationships.ConnectsToConsulAgent
  Kibana:
    type: starlings.nodes.Kibana
    instances:
      deploy: 1
    interfaces:
      cloudify.interfaces.lifecycle:
        stop: wrapper/Kibana/tosca.interfaces.node.lifecycle.Standard/stop/artifacts/kibana-types/scripts/_a4c_kibana-4_stop.py
        start: wrapper/Kibana/tosca.interfaces.node.lifecycle.Standard/start/artifacts/kibana-types/scripts/_a4c_kibana-4_start.py
        create: wrapper/Kibana/tosca.interfaces.node.lifecycle.Standard/create/artifacts/kibana-types/scripts/_a4c_kibana-4_install.py
      custom:
        importDashboardOnKibana: wrapper/Kibana/custom/importDashboardOnKibana/artifacts/kibana-types/scripts/_a4c_importDashboardOnKibana.py
    relationships:
      - target: Consul_A_KBN
        type: starlings.relationships.ConnectsToConsulAgent
      - target: Elasticsearch
        type: starlings.relationships.ConnectsKibanaToElasticsearch
        source_interfaces:
          cloudify.interfaces.relationship_lifecycle:
            preconfigure: wrapper/Kibana_Elasticsearch/connectsKibanaToElasticsearchElasticsearch/artifacts/kibana-types/scripts/_a4c_kibana-to-elasticsearch.py
      - target: Java_KBN
        type: starlings.relationships.HostedOnJavaRuntime
  Elasticsearch:
    type: starlings.nodes.Elasticsearch
    instances:
      deploy: 1
    interfaces:
      cloudify.interfaces.lifecycle:
        stop: wrapper/Elasticsearch/tosca.interfaces.node.lifecycle.Standard/stop/artifacts/elasticsearch-types/scripts/_a4c_elasticsearch_stop.py
        start: wrapper/Elasticsearch/tosca.interfaces.node.lifecycle.Standard/start/artifacts/elasticsearch-types/scripts/_a4c_elasticsearch_start.py
        create: wrapper/Elasticsearch/tosca.interfaces.node.lifecycle.Standard/create/artifacts/elasticsearch-types/scripts/_a4c_elasticsearch_install.py
        configure: wrapper/Elasticsearch/tosca.interfaces.node.lifecycle.Standard/configure/artifacts/elasticsearch-types/scripts/_a4c_elasticsearch_configure.py
    relationships:
      - target: Java_ES
        type: starlings.relationships.HostedOnJavaRuntime
      - target: Consul_A_ES
        type: starlings.relationships.ConnectsToConsulAgent
  BeatsDashboards:
    type: starlings.nodes.BeatsDashboards
    instances:
      deploy: 1
    interfaces:
      cloudify.interfaces.lifecycle:
        create: wrapper/BeatsDashboards/tosca.interfaces.node.lifecycle.Standard/create/artifacts/kibana-types/scripts/_a4c_load-beats-dashboards.py
    relationships:
      - target: Kibana
        type: starlings.relationships.BeatsDashboardsHostedOnKibana
  FileBeat:
    type: starlings.nodes.FileBeat
    instances:
      deploy: 1
    interfaces:
      cloudify.interfaces.lifecycle:
        stop: wrapper/FileBeat/tosca.interfaces.node.lifecycle.Standard/stop/artifacts/beats-types/scripts/_a4c_stop_beat.py
        start: wrapper/FileBeat/tosca.interfaces.node.lifecycle.Standard/start/artifacts/beats-types/scripts/_a4c_start_beat.py
        configure: wrapper/FileBeat/tosca.interfaces.node.lifecycle.Standard/configure/artifacts/beats-types/scripts/_a4c_configure_filebeat.py
        create: wrapper/FileBeat/tosca.interfaces.node.lifecycle.Standard/create/artifacts/beats-types/scripts/_a4c_install_beat.py
    relationships:
      - target: Elasticsearch
        type: starlings.relationships.ConnectsBeatToES
        source_interfaces:
          cloudify.interfaces.relationship_lifecycle:
            postconfigure: wrapper/FileBeat_Elasticsearch/connectsBeatToEsElasticsearch/artifacts/beats-types/scripts/_a4c_post_configure_beat_to_elasticsearch.py
      - target: Logstash
        type: starlings.relationships.ConnectsBeatToLS
        source_interfaces:
          cloudify.interfaces.relationship_lifecycle:
            postconfigure: wrapper/FileBeat_Logstash/connectsBeatToLsLogstash/artifacts/beats-types/scripts/_a4c_post_configure_beat_to_logstash.py
      - target: Compute_LS
        type: cloudify.relationships.contained_in
      - target: Consul_A_LS
        type: starlings.relationships.ConnectsToConsulAgent
  Consul_Server:
    type: starlings.nodes.Consul
    instances:
      deploy: 1
    interfaces:
      cloudify.interfaces.lifecycle:
        stop: wrapper/Consul_Server/tosca.interfaces.node.lifecycle.Standard/stop/artifacts/consul-types/scripts/_a4c_consul_stop.py
        start: wrapper/Consul_Server/tosca.interfaces.node.lifecycle.Standard/start/artifacts/consul-types/scripts/_a4c_consul_start.py
        create: wrapper/Consul_Server/tosca.interfaces.node.lifecycle.Standard/create/artifacts/consul-types/scripts/_a4c_consul_install.py
        configure: wrapper/Consul_Server/tosca.interfaces.node.lifecycle.Standard/configure/artifacts/consul-types/scripts/_a4c_consul_configure.py
    relationships:
      - target: Compute_CS
        type: cloudify.relationships.contained_in
  PacketBeatKBN:
    type: starlings.nodes.PacketBeat
    instances:
      deploy: 1
    interfaces:
      cloudify.interfaces.lifecycle:
        stop: wrapper/PacketBeatKBN/tosca.interfaces.node.lifecycle.Standard/stop/artifacts/beats-types/scripts/_a4c_stop_beat.py
        start: wrapper/PacketBeatKBN/tosca.interfaces.node.lifecycle.Standard/start/artifacts/beats-types/scripts/_a4c_start_beat.py
        configure: wrapper/PacketBeatKBN/tosca.interfaces.node.lifecycle.Standard/configure/artifacts/beats-types/scripts/_a4c_configure_packetbeat.py
        create: wrapper/PacketBeatKBN/tosca.interfaces.node.lifecycle.Standard/create/artifacts/beats-types/scripts/_a4c_install_beat.py
    relationships:
      - target: Compute_KBN
        type: cloudify.relationships.contained_in
      - target: Consul_A_KBN
        type: starlings.relationships.ConnectsToConsulAgent
      - target: Logstash
        type: starlings.relationships.ConnectsBeatToLS
        source_interfaces:
          cloudify.interfaces.relationship_lifecycle:
            postconfigure: wrapper/PacketBeatKBN_Logstash/connectsBeatToLsLogstash/artifacts/beats-types/scripts/_a4c_post_configure_beat_to_logstash.py
      - target: Elasticsearch
        type: starlings.relationships.ConnectsBeatToES
        source_interfaces:
          cloudify.interfaces.relationship_lifecycle:
            postconfigure: wrapper/PacketBeatKBN_Elasticsearch/connectsBeatToEsElasticsearch/artifacts/beats-types/scripts/_a4c_post_configure_beat_to_elasticsearch.py
  PacketBeatES:
    type: starlings.nodes.PacketBeat
    instances:
      deploy: 1
    interfaces:
      cloudify.interfaces.lifecycle:
        stop: wrapper/PacketBeatES/tosca.interfaces.node.lifecycle.Standard/stop/artifacts/beats-types/scripts/_a4c_stop_beat.py
        start: wrapper/PacketBeatES/tosca.interfaces.node.lifecycle.Standard/start/artifacts/beats-types/scripts/_a4c_start_beat.py
        configure: wrapper/PacketBeatES/tosca.interfaces.node.lifecycle.Standard/configure/artifacts/beats-types/scripts/_a4c_configure_packetbeat.py
        create: wrapper/PacketBeatES/tosca.interfaces.node.lifecycle.Standard/create/artifacts/beats-types/scripts/_a4c_install_beat.py
    relationships:
      - target: Elasticsearch
        type: starlings.relationships.ConnectsBeatToES
        source_interfaces:
          cloudify.interfaces.relationship_lifecycle:
            postconfigure: wrapper/PacketBeatES_Elasticsearch/connectsBeatToEsElasticsearch/artifacts/beats-types/scripts/_a4c_post_configure_beat_to_elasticsearch.py
      - target: Logstash
        type: starlings.relationships.ConnectsBeatToLS
        source_interfaces:
          cloudify.interfaces.relationship_lifecycle:
            postconfigure: wrapper/PacketBeatES_Logstash/connectsBeatToLsLogstash/artifacts/beats-types/scripts/_a4c_post_configure_beat_to_logstash.py
      - target: Compute_ES
        type: cloudify.relationships.contained_in
      - target: Consul_A_ES
        type: starlings.relationships.ConnectsToConsulAgent
  Java_ES:
    type: starlings.nodes.Java
    instances:
      deploy: 1
    interfaces:
      cloudify.interfaces.lifecycle:
        create: wrapper/Java_ES/tosca.interfaces.node.lifecycle.Standard/create/artifacts/java-types/scripts/_a4c_java_install.py
    relationships:
      - target: Compute_ES
        type: cloudify.relationships.contained_in
  TopBeat:
    type: starlings.nodes.TopBeat
    instances:
      deploy: 1
    interfaces:
      cloudify.interfaces.lifecycle:
        stop: wrapper/TopBeat/tosca.interfaces.node.lifecycle.Standard/stop/artifacts/beats-types/scripts/_a4c_stop_beat.py
        start: wrapper/TopBeat/tosca.interfaces.node.lifecycle.Standard/start/artifacts/beats-types/scripts/_a4c_start_beat.py
        configure: wrapper/TopBeat/tosca.interfaces.node.lifecycle.Standard/configure/artifacts/beats-types/scripts/_a4c_configure_topbeat.py
        create: wrapper/TopBeat/tosca.interfaces.node.lifecycle.Standard/create/artifacts/beats-types/scripts/_a4c_install_beat.py
    relationships:
      - target: Compute_LS
        type: cloudify.relationships.contained_in
      - target: Elasticsearch
        type: starlings.relationships.ConnectsBeatToES
        source_interfaces:
          cloudify.interfaces.relationship_lifecycle:
            postconfigure: wrapper/TopBeat_Elasticsearch/connectsBeatToEsElasticsearch/artifacts/beats-types/scripts/_a4c_post_configure_beat_to_elasticsearch.py
      - target: Logstash
        type: starlings.relationships.ConnectsBeatToLS
        source_interfaces:
          cloudify.interfaces.relationship_lifecycle:
            postconfigure: wrapper/TopBeat_Logstash/connectsBeatToLsLogstash/artifacts/beats-types/scripts/_a4c_post_configure_beat_to_logstash.py
      - target: Consul_A_LS
        type: starlings.relationships.ConnectsToConsulAgent
  Java_LS:
    type: starlings.nodes.Java
    instances:
      deploy: 1
    interfaces:
      cloudify.interfaces.lifecycle:
        create: wrapper/Java_LS/tosca.interfaces.node.lifecycle.Standard/create/artifacts/java-types/scripts/_a4c_java_install.py
    relationships:
      - target: Compute_LS
        type: cloudify.relationships.contained_in
  Java_KBN:
    type: starlings.nodes.Java
    instances:
      deploy: 1
    interfaces:
      cloudify.interfaces.lifecycle:
        create: wrapper/Java_KBN/tosca.interfaces.node.lifecycle.Standard/create/artifacts/java-types/scripts/_a4c_java_install.py
    relationships:
      - target: Compute_KBN
        type: cloudify.relationships.contained_in
 
 
plugins:
  custom_wf_plugin:
    executor: central_deployment_agent
    source: custom_wf_plugin
 
workflows:
  a4c_install: custom_wf_plugin.plugin.workflows.a4c_install
  a4c_uninstall: custom_wf_plugin.plugin.workflows.a4c_uninstall
  a4c_scale:
    mapping: custom_wf_plugin.plugin.workflows.a4c_scale
    parameters:
      node_id:
        description: Which node (not node instance) to scale
      delta:
        description: >
            How many nodes should be added/removed.
            A positive number denotes increase of instances.
            A negative number denotes decrease of instances.
        default: 1
      scale_compute:
        description: >
            If node is contained (transitively) within a compute node
            and this property is 'true', operate on compute node instead
            of 'node_id'
        default: true
  a4c_heal:
    mapping: custom_wf_plugin.plugin.workflows.a4c_heal
    parameters:
      node_instance_id:
        description: Which node instance has failed
      diagnose_value:
        description: Diagnosed reason of failure
        default: Not provided
