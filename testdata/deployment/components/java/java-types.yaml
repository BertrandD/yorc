#
# Starlings
# Copyright (C) 2015 Bull S.A.S. - All rights reserved
#

tosca_definitions_version: ${tosca.definitions.version}
description: Allow to select a Java version to install on a system and to host other components requiring Java on top of it
template_name: java-types
template_version: ${project.version}
template_author: ${module.author}

imports:
  - tosca-normative-types:${tosca.normative.types.version}

node_types:
  starlings.nodes.Java:
    derived_from: tosca.nodes.SoftwareComponent
    description: Installation of a Java module
    tags:
      icon: /images/java-icon.png
    properties:
      version:
        type: version
        description: The installed Java version
        default: 7
        constraints:
          - valid_values: [6, 7, 8]
      jre:
        type: boolean
        description: Is the installed Java a JRE or a JDK
        default: true
      headless:
        type: boolean
        description: >
          This option is only relevant when installing a JRE. If true try to install an headless version of the JRE. That means
          without graphical libraries. Depending on the OS and the Java version the headless version may not be available, in this case the
          usual version will be used.
        default: true
      download_url:
        type: string
        description: >
          By default we will try to use the OS package manager to install Java. If you use this property you can specify an url used to
          download a Java archive. This url should be a direct access url without redirection. Supported archive types are: zip, tar,
          tar.gz, tgz, tar.bz2. The Java distribution should be include in a top directory inside of this archive (ie: This directory is the
          JAVA_HOME directory).
        required: false
        constraints:
          - pattern: ^(http|https|ftp)://.+/.+\.(zip|tar|tar.gz|tgz|tar.bz2)$
    capabilities:
      java_host:
        type: starlings.capabilities.JavaHosting
        properties:
          required: false
        upper_bound: unbounded
    interfaces:
      Standard:
        create:
          inputs:
            JAVA_VERSION: { get_property: [SELF, version] }
            JAVA_IS_JRE: { get_property: [SELF, jre] }
            JAVA_IS_HEADLESS: { get_property: [SELF, headless] }
            JAVA_DOWNLOAD_URL: { get_property: [SELF, download_url] }
          implementation: scripts/java_install.sh
    artifacts:
      - scripts: scripts
        type: tosca.artifacts.File
      - utils_scripts: utils_scripts
        type: tosca.artifacts.File

relationship_types:
  starlings.relationships.HostedOnJavaRuntime:
    derived_from: tosca.relationships.HostedOn
    description: Relationship between a Java SoftwareComponent and its RunOnJVM
    valid_sources: [ starlings.capabilities.JavaHosting ]
    valid_targets: [ starlings.capabilities.JavaHosting ]

capability_types:
  starlings.capabilities.JavaHosting:
    derived_from: tosca.capabilities.Container
