tosca_definitions_version: alien_dsl_1_3_0
description: ""
template_name: elastic-Environment
template_version: 0.1.0-SNAPSHOT
template_author: admin

imports:
  - kubernetes-samples-types: types/kubernetes-samples-types.yml


topology_template:
  node_templates:
    Kibana:
      type: janus.nodes.Docker.Kibana
      properties:
        docker_ports: 5601
      requirements:
        - elastic:
            node: ElasticSearch
            capability: janus.capabilities.endpoint.docker.Elastic
            relationship: tosca.relationships.ConnectsTo
    ElasticSearch:
      type: janus.nodes.Docker.ElasticSearch
      properties:
        docker_ports: 9200
      capabilities:
        scalable:
          properties:
            min_instances: 1
            max_instances: 1
            default_instances: 1
        elastic:
          properties:
            protocol: tcp
            secure: false
            network_name: PRIVATE
            initiator: source
  workflows:
    install:
      steps:
        Kibana_initial:
          node: Kibana
          activity:
            set_state: initial
          on-success:
            - Kibana_creating
        Kibana_creating:
          node: Kibana
          activity:
            set_state: creating
          on-success:
            - Kibana_created
        Kibana_created:
          node: Kibana
          activity:
            set_state: created
          on-success:
            - Kibana_configuring
            - ElasticSearch_configuring
        Kibana_configuring:
          node: Kibana
          activity:
            set_state: configuring
          on-success:
            - configure_Kibana
        configure_Kibana:
          node: Kibana
          activity:
            call_operation: tosca.interfaces.node.lifecycle.Standard.configure
          on-success:
            - Kibana_configured
        Kibana_configured:
          node: Kibana
          activity:
            set_state: configured
          on-success:
            - Kibana_starting
        Kibana_starting:
          node: Kibana
          activity:
            set_state: starting
          on-success:
            - start_Kibana
        start_Kibana:
          node: Kibana
          activity:
            call_operation: tosca.interfaces.node.lifecycle.Standard.start
          on-success:
            - Kibana_started
        Kibana_started:
          node: Kibana
          activity:
            set_state: started
        ElasticSearch_initial:
          node: ElasticSearch
          activity:
            set_state: initial
          on-success:
            - ElasticSearch_creating
        ElasticSearch_creating:
          node: ElasticSearch
          activity:
            set_state: creating
          on-success:
            - ElasticSearch_created
        ElasticSearch_created:
          node: ElasticSearch
          activity:
            set_state: created
          on-success:
            - ElasticSearch_configuring
        ElasticSearch_configuring:
          node: ElasticSearch
          activity:
            set_state: configuring
          on-success:
            - configure_ElasticSearch
        configure_ElasticSearch:
          node: ElasticSearch
          activity:
            call_operation: tosca.interfaces.node.lifecycle.Standard.configure
          on-success:
            - ElasticSearch_configured
        ElasticSearch_configured:
          node: ElasticSearch
          activity:
            set_state: configured
          on-success:
            - ElasticSearch_starting
        ElasticSearch_starting:
          node: ElasticSearch
          activity:
            set_state: starting
          on-success:
            - start_ElasticSearch
        start_ElasticSearch:
          node: ElasticSearch
          activity:
            call_operation: tosca.interfaces.node.lifecycle.Standard.start
          on-success:
            - ElasticSearch_started
        ElasticSearch_started:
          node: ElasticSearch
          activity:
            set_state: started
          on-success:
            - Kibana_configuring
    uninstall:
      steps:
        Kibana_stopping:
          node: Kibana
          activity:
            set_state: stopping
          on-success:
            - stop_Kibana
        stop_Kibana:
          node: Kibana
          activity:
            call_operation: tosca.interfaces.node.lifecycle.Standard.stop
          on-success:
            - Kibana_stopped
        Kibana_stopped:
          node: Kibana
          activity:
            set_state: stopped
          on-success:
            - ElasticSearch_stopping
            - Kibana_deleting
        Kibana_deleting:
          node: Kibana
          activity:
            set_state: deleting
          on-success:
            - delete_Kibana
        delete_Kibana:
          node: Kibana
          activity:
            call_operation: tosca.interfaces.node.lifecycle.Standard.delete
          on-success:
            - Kibana_deleted
        Kibana_deleted:
          node: Kibana
          activity:
            set_state: deleted
        ElasticSearch_stopping:
          node: ElasticSearch
          activity:
            set_state: stopping
          on-success:
            - stop_ElasticSearch
        stop_ElasticSearch:
          node: ElasticSearch
          activity:
            call_operation: tosca.interfaces.node.lifecycle.Standard.stop
          on-success:
            - ElasticSearch_stopped
        ElasticSearch_stopped:
          node: ElasticSearch
          activity:
            set_state: stopped
          on-success:
            - ElasticSearch_deleting
        ElasticSearch_deleting:
          node: ElasticSearch
          activity:
            set_state: deleting
          on-success:
            - delete_ElasticSearch
        delete_ElasticSearch:
          node: ElasticSearch
          activity:
            call_operation: tosca.interfaces.node.lifecycle.Standard.delete
          on-success:
            - ElasticSearch_deleted
        ElasticSearch_deleted:
          node: ElasticSearch
          activity:
            set_state: deleted
    start:
      steps:
        Kibana_starting:
          node: Kibana
          activity:
            set_state: starting
          on-success:
            - start_Kibana
        start_Kibana:
          node: Kibana
          activity:
            call_operation: tosca.interfaces.node.lifecycle.Standard.start
          on-success:
            - Kibana_started
        Kibana_started:
          node: Kibana
          activity:
            set_state: started
        ElasticSearch_starting:
          node: ElasticSearch
          activity:
            set_state: starting
          on-success:
            - start_ElasticSearch
        start_ElasticSearch:
          node: ElasticSearch
          activity:
            call_operation: tosca.interfaces.node.lifecycle.Standard.start
          on-success:
            - ElasticSearch_started
        ElasticSearch_started:
          node: ElasticSearch
          activity:
            set_state: started
          on-success:
            - Kibana_starting
    stop:
      steps:
        Kibana_stopping:
          node: Kibana
          activity:
            set_state: stopping
          on-success:
            - stop_Kibana
        stop_Kibana:
          node: Kibana
          activity:
            call_operation: tosca.interfaces.node.lifecycle.Standard.stop
          on-success:
            - Kibana_stopped
        Kibana_stopped:
          node: Kibana
          activity:
            set_state: stopped
        ElasticSearch_stopping:
          node: ElasticSearch
          activity:
            set_state: stopping
          on-success:
            - stop_ElasticSearch
        stop_ElasticSearch:
          node: ElasticSearch
          activity:
            call_operation: tosca.interfaces.node.lifecycle.Standard.stop
          on-success:
            - ElasticSearch_stopped
        ElasticSearch_stopped:
          node: ElasticSearch
          activity:
            set_state: stopped
